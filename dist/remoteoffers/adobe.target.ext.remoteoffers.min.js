/*!
 * adobe.target.ext.remoteoffers.js v0.2.0
 *
 * Copyright 1996-2016. Adobe Systems Incorporated. All rights reserved.
 *
 * Example:
    adobe.target.ext.remoteoffers(
    [
        {
            'url': '/promotion1.html',          //remote offer url (required, must be same domain)
            'selector': '.menu a',              //CSS selector of element to deliver offer to
            'callbackSuccess': function(){},    //successful callback
            'callbackError':   function(){},    //error handler
            'method': 'replace'                 //method to handle offer injection into DOM: 'append' (default) or 'replace'
        },
        {
            'url': '/promotion2.html',
            'selector': '#banner'
        }
    ],
    {debug:true}
    );
 */
!function(){"use strict";var e=function(){},t=function(t,r,n){var o=400,c=3e4,a=setInterval(function(){var i=t();if(0>=c)return clearInterval(a),void("function"==typeof n&&n());for(var l=!1,s=0;s<i.length;s++)i[s]||(l=!0);return l===!1?(clearInterval(a),e("el is ready"),void("function"==typeof r&&r())):void(c-=o)},o)},r=function(t,r,n){e("XHR to "+t);var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&(200==o.status?r(o.responseText):n(o.status))},o.open("GET",t,!0),o.send()},n=function(e){var t=document.getElementsByTagName("head")[0];if(t){var r=document.createElement("style");r.setAttribute("type","text/css"),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.insertBefore(r,t.firstChild)}},o=function(o,c,a,i,l){e("getOffer");var s=c+"{visibility:hidden}";n(s),r(o,function(r){e("Call success, will applyOffer "+o+" to "+c),t(function(){return[document.querySelector(c)]},function(){var t=document.querySelector(c);if("string"==typeof l&&"replace"===l){var n=document.createElement("div");t.parentNode.replaceChild(n,t),t=n,e("method:"+l)}adobe.target.applyOffer({element:t,offer:[{type:"html",content:r}]}),e("Offer applied to "+c),"function"==typeof a&&(e("Success handler"),a())})},function(t){e("Error loading content for '"+o+"', status: '"+t);var r=document.querySelector(c);r&&(r.style.visibility="visible"),"function"==typeof i&&(e("Error handler"),i())})},c=function(t,r){var n=function(t,n){e=n.debug?function(e){r.log("ATX:"+e)}:e;for(var c=0;c<t.length;c++){var a=t[c];a.url&&a.selector?o(a.url,a.selector,a.callbackSuccess,a.callbackError,a.method):e("Error:missing URL or selector")}};return n};adobe.target.registerExtension({name:"remoteoffers",modules:["dom","logger"],register:c})}();
