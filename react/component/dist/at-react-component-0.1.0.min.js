/**
 * Copyright 2016 Adobe Systems, Inc. http://www.adobe.com
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t};!function(t,e){function o(t){return(t?t+" ":"")+"mboxDefault"}function n(t){return t.replace(/\bmboxDefault\b/,"")}function a(t){t=t||{};var e=null;return Object.keys(t).filter(function(t){return t.startsWith("data-")&&!["data-mbox","data-timeout"].includes(t)}).forEach(function(o,n){0===n&&(e={}),e[o]=t[o]}),e}function r(t,e,o,n){return!Object.is(t.state.atParams,n)||e&&t.state.mbox!==e||o&&t.state.timeout!==o}function s(t,o){console.log("getOffers"),e.getOffer({mbox:t.state.mbox,params:t.state.atParams,timeout:t.state.timeout,success:function(e){t.setState({gotOffers:!0,offerData:e})},error:function(e,a){o.log("getOffer error: ",a,e),t.mboxDiv.className=n(t.mboxDiv.className)}})}function i(t){return t=t||{},{atParams:t.params||null}}function u(t,e){return t=t||{},{className:"mboxDefault","data-mbox":t.mbox||e.globalMboxName,"data-timeout":t.timeout||e.timeout}}function c(e){return t.createElement("div",_extends({ref:function(t){e.mboxDiv=t}},e.props,{className:o(e.props.className)}),e.props.children)}function f(t,e){e.log("MboxComponentDidMount")}function m(t,e){console.log("Mbox componentWillReceiveProps");var o=e["data-mbox"],n=parseInt(e["data-timeout"],10),s=a(e);r(t,o,n,s)&&t.setState({atParams:s||t.state.atParams,mbox:o||t.state.mbox,timeout:n||t.state.timeout,shouldRefresh:!0})}function l(t,e){e.log("MboxComponentDidUpdate"),t.state&&(t.state.gotOffers&&(console.log("Applying"),adobe.target.applyOffer({mbox:t.state.mbox,offer:t.state.offerData,element:t.mboxDiv}),t.mboxDiv.className=n(t.mboxDiv.className),t.setState({gotOffers:!1})),t.state.shouldRefresh&&(console.log("Refreshing"),s(t,e),t.setState({shouldRefresh:!1})))}e.registerExtension({name:"react.createMboxComponent",modules:["settings","logger"],register:function(e,o){return function(n){return t.createClass({getInitialState:function(){return i(n)},getDefaultProps:function(){return u(n,e)},render:function(){return c(this)},componentDidMount:function(){return f(this,o)},componentWillReceiveProps:function(t){return m(this,t)},componentDidUpdate:function(){return l(this,o)}})}}})}(React,adobe.target);